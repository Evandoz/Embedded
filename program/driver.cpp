#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>
#include <unistd.h>
#include <sys/ioctl.h>
#include <sys/mman.h>
///#include <linux/delay.h>
//#define TUBE_IOCTROL  0x11
//#define DOT_IOCTROL   0x12

#include "./driver.h"

int MyDriver::toggleDigLed(int on) {
    int fd;
    unsigned int LEDWORD;
    unsigned int MLEDA[8];
    unsigned char LEDCODE[10]={0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};
    unsigned char dd_data[16][10]={{0xff,0,0,0,0,0,0,0,0,0},
    {0,0xff,0,0,0,0,0,0,0,0},
    {0,0,0xff,0,0,0,0,0,0,0},
    {0,0,0,0xff,0,0,0,0,0,0},
    {0,0,0,0,0xff,0,0,0,0,0},
    {0,0,0,0,0,0xff,0,0,0,0},
    {0,0,0,0,0,0,0xff,0,0,0},
    {0,0,0,0,0,0,0,0xff,0,0},
    {0x1,0x1,0x1,0x1,0x1,0x1,0x1,0x1,0,0},
    {0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0,0},
    {0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0,0},
    {0x8,0x8,0x8,0x8,0x8,0x8,0x8,0x8,0,0},
    {0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0,0},
    {0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0,0},
    {0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0,0},
    {0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0,0},
};
	
    fd=open("/dev/s3c2410_led0",O_RDWR);
    if (fd < 0) {
        printf("####Led device open fail: /dev/s3c2410_led0####\n");
        return (-1);
    }

   int i=on/10,j=on%10;
	LEDWORD=(LEDCODE[i]<<8)|LEDCODE[j];
   ioctl(fd,0x12,LEDWORD);	

	 write(fd,dd_data[4],10);

    close(fd);
    return 0;
}
 
int MyDriver::toggleLed(int on){
        int fd;

        fd = open("/dev/leds", 0);
        if (fd < 0) {
                printf("### LED device open failed: /dev/leds\n");
                return (-1);
        }
        ioctl(fd, on);
        close(fd);
        return 0;
}

